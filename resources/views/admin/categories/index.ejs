<%- include("../../layouts/header.ejs") %>
<form action="" method="post" id="delete-category-form"></form>
<main class="">
  <div class="row">
    <div class="container">
      <!-- Button trigger modal -->
      <div class="container d-md-flex justify-content-between my-3">
        <h4>Category</h4>
        <button
          type="button"
          class="btn btn-apex-green text-white px-3 rounded-3"
          data-bs-toggle="modal"
          data-bs-target="#createModal"
        >
          Create
        </button>
      </div>

      <!-- Create Modal -->
      <div
        class="modal fade"
        id="createModal"
        tabindex="-1"
        aria-labelledby="createModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="createModalLabel">
                Create Category
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form method="post" action="/admin/category/create">
                <div class="form-group">
                  <label for="categoryName">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="categoryName"
                    name="categoryName"
                  />
                </div>

                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                  <button
                    type="submit"
                    class="btn btn-apex-green mx-3 text-white"
                  >
                    Create Category
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table
        class="table table-apex-secondary table-striped rounded-3 overflow-hidden"
      >
        <thead class="table-apex-primary">
          <tr>
            <th scope="col" class="col-1 text-center">ID</th>
            <th scope="col" class="col-7">Category</th>
            <th scope="col" class="col-4">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% let i = 1; categories.forEach((category) => { %>
          <tr class="">
            <th scope="row" class="col-1 text-center"><%= i %></th>
            <td class="col-7"><%= category.name %></td>
            <td class="col-4">
              <div class="d-flex">
                <a
                  href="/admin/category/edit/<%- category.id %>"
                  class="btn me-3 mb-3 bg-info text-white d-block"
                >
                  Edit
                </a>
                <a
                  data-id="<%= category.id %>"
                  href="#"
                  class="deleteCategory btn mx-3 mb-3 bg-danger text-white d-block"
                >
                  Delete
                </a>
              </div>
            </td>
          </tr>
          <% i++; }) %>
        </tbody>
      </table>
    </div>
  </div>
</main>

<script>
  $(".deleteCategory").click(deleteCategory)
  function deleteCategory() {
    const categoryId = this.getAttribute("data-id")
    swal({
      title: "Are you sure?",
      text: "Once deleted, you will not be able to recover this category!",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    }).then((willDelete) => {
      if (willDelete) {
        $("#delete-category-form")
          .attr("action", `/admin/category/delete/${categoryId}`)
          .submit()
      }
    })
  }
</script>

<%- include("../../layouts/footer.ejs") %>
